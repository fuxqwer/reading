要点

## 分布式系统

### 1. 为什么要进行系统拆分

- 为什么拆？如何拆？拆分后不用 dubbo 可以吗？
  - 代码冲突、上线所有人都要检查，测试、升级困难
  - 多轮拆分
  - 可以，http等，但是需要考虑，数据传输，超时，重试等问题

### 2. 分布式服务框架

- 说一下 dubbo 的工作原理？注册中心挂了可以继续通信吗？
  - 10层
  - 可以，consumer会有缓存
- dubbo 支持那些序列化协议？说一下 hessian 的数据结构？PB知道吗？为什么PB效率是最好的？
  - 
- dubbo 负载均衡策略和高可用策略都有哪些？动态代理策略呢？
  - 
- dubbo 的 spi 思想是什么？
  - 
- 如何基于 dubbo 进行服务治理、服务降级、失败重试以及超时重试？
  - 
- 分布式服务接口请求的幂等性如何设计（比如不能重复扣款）？
  - 扣之前在数据库中插入基于订单id的唯一主键的订单流水，如果已经支付，则会报出主键冲突
- 分布式服务接口请求的顺序性如何保证？
  - 
- 如何自己设计一个类似 dubbo 的 rpc 框架
  - 

### 3. 分布式锁

- 使用 redis 如何实现分布式锁？使用 zk 来设计分布式锁可以吗？这两种分布式锁的实现方式哪种效率比较高？
  - 

### 4. 分布式事务

- 分布式事务了解吗？如何解决分布式事务问题？TCC 如果出现网络连接不同怎么办？XA 的一致性如何保证？

### 5.分布式会话

- 集群部署时的分布式 session 如何实现？

## 高并发架构

### 1. 如何设计一个高并发系统

### 2. 消息队列

- 为什么要使用消息队列？消息队列的优缺点？对比不同的消息队列产品各有什么优缺点？
- 如何保证消息队列的高可用？
  - 保存副本
- 如何保证消息不被重复消费（消息队列的幂等性问题）？
  - offset 编号确定已经消费了
  - 一般的 mq 重启后可能出现
  - 使用 redis 或者内存、或者数据库的唯一主键（插入报错，不会导致数据库脏数据），不被重复消费
- 如何保证消息的可靠性传输（消息丢失的问题）？
  - 生产者写消息的时候：网络传输过程，或者传输完成，mq挂了
    - 使用事务处理
    - confirm 机制（非阻塞，吞吐量高，推荐使用）
      - 发送，回调，确定发送成功或者失败
  - mq 自己把数据丢了：收到消息后暂存到内存中，突然挂了
    - 持久化到磁盘
  - 消费的时候丢了：拿到了消息，还没消费完自己就挂掉了，mq以为已经消费了
- 如何保证消息的顺序性？
  - 使用不同的 quene，通过 key hash 分发，确保每个消费者消费有序
- 如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续挤压几个小时，说说怎么解决？
  - 临时修改消费者代码，让消费者放到新的 topic 中，再让更多的消费者去完成，落库等
  - 线上基本上不设置过期时间，如果设置了消息过期了需要手动再查出来再生产
  - 满了的话，可以快速消费（不处理，只是消费）后，晚上（空闲时）补上

### 3. 搜索引擎

- es 的分布式架构原理（es 如何实现分布式的）？
- es 的写入数据工作原理是什么？es 的查询数据的工作原理是什么？底层的 lucene 介绍一下？倒排索引？
- es 在大数据量（数十亿级别）如何提高查询效率？
- es 生产集群的部署架构是什么？每个索引的数据量有多少？每个索引大概有多少个分片？

### 4. 缓存

- 在项目中缓存时如何使用的？缓存使用不当会造成什么后果？

  为什么使用？

  > 高性能
  >
  > - 多次查询一个复杂数据，第一次费时，之后快速
  >
  > 高并发
  >
  > - 将 3/4 数据放在缓存，将 1/4 数据直接查库，降低数据库的压力

  后果：

  > - 缓存与数据库双写不一致
  > - 缓存雪崩
  > - 缓存穿透
  > - 缓存并发竞争

- redis 和 memcached 有什么区别？redis 的线程模型是什么？为什么单线程的 redis 比多线程的 memcached 效率要高？
  - 线程模型：单线程异步
    - 文件事件处理器，采用 IO 多路复用机制监听多个 socket，根据 socket 上的时间来选择对应的事件处理器来处理这个事件。
  - 效率高
    - 内存操作
    - 核心是基于非阻塞 IO 多路复用机制
    - 单线程避免了多线程的频繁上下文切换问题
  
- redis 都有哪些数据类型？分别在哪些场景下使用比较合适？
  - string 基本数据结构 get/set
  - hash 类似于 map 的一种结构，主要是存放简单的对象，
  - list 有序列表
  - set 无序集合
  - sorted set 
  
- redis 的过期策略都有哪些？手写一个 LRU 代码实现？
  - 定期删除+惰性删除
  - 内存淘汰机制
    - 手写 LRU
    - 如何保证 redis 的高并发、高可用、持久化？redis 的主从复制原理介绍一下？reids 哨兵原理介绍一下？
  
- redis 的持久化有哪几种方式？不同的持久化机制都有什么优缺点？持久化机制具体底层是如何实现的？
  - 高并发、高可用
    - 主从架构，一主多从。每个实例都容纳了完整数据
    - redis 集群
    - 高可用加上哨兵
  -  持久化的意义：故障恢复
  
- redis 集群模式的工作原理？在集群模式下 redis 的 key 是如何寻址的？分布式寻址都有哪些算法？了解一致性 hash 算法吗？如何动态增加和删除一个节点？

  - 

- 什么是 redis 的雪崩和穿透？redis 崩溃后会怎样？系统改如何应对这种情况？如何处理 redis 穿透？

  - 雪崩
    - 缓存失效，数据库承载不了流量，挂掉
    - 事前保证redis的集群高可用，在系统内部使用chcache小缓存，
    - 限流和降级
  - 穿透
    - 缓存和数据库都没有数据-恶意攻击场景
      - 将 key unkown 放入缓存

- 如何保证缓存与数据库双写一致性？

  - 让读写串型化到一个内存队列，

- redis 的并发竞争问题是什么？如何解决这个问题？了解 redis 事务的 CAS 方案吗？

  - 分布式锁

- 

### 5. 分库分表

- 为什么要分库分表（设计高并发系统的时候，数据库层面该如何设计）？用过哪些分库分表的中间件？不同的分库分表中间件都有什么优缺点？具体如何对数据库拆分？如何垂直拆分或者水平拆分？
  - sharding jdbc
  - mycat
  - 数据库分为垂直拆分或者水平拆分
- 现在有一个分库分表的系统，未来要分库分表，如何设计才可以让系统从未分库分表动态切换到分库分表上？
  - 停机分库分表
    - 停机几小时
    - 如果没搞定，回滚
    - 时间长了人受不了
  - 不停机双写方案
- 如何设计动态扩容的分库分表方案？
  - 停机扩容
  - 一开始就是32个库，32个表，共1024张表
- 分库分表后，id 主键如何处理？
  - 搞一个生成主键的库，全局唯一
    - 简单
    - 但是成为瓶颈
  - UUID
    - 唯一
    - 不合适
  - 获取时间和业务字段值
  - 雪花算法 (snowflake ) 

### 6. 读写分离

- 如何实现 mysql 的读写分离？mysql 的主从复制原理是啥？如何解决主从同步的延时问题？  
  - 原生支持 主从复制 

## 高可用架构

### 1. 如何设计一个高可用系统

### 2. 限流

- 如何限流？在工作中是怎么做的？说一下具体实现？

### 3. 熔断

- 如何进行熔断？熔断框架都有哪些？具体原理知道吗？

### 4. 降级
